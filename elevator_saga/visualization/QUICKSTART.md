# 快速开始 - 电梯调度可视化

## 步骤1: 安装依赖

```bash
# 安装可视化相关依赖
pip install ".[visualization]"

# 或者单独安装
pip install fastapi uvicorn websockets
```

## 步骤2: 运行示例并记录

```bash
# 确保电梯服务器正在运行（默认端口8000）
# 如果没有，先启动服务器...

# 运行可视化示例
python -m elevator_saga.client_examples.visual_example
```

运行完成后会显示记录文件路径，例如：
```
✅ 状态记录已保存: E:\...\recordings\simulation_20251005_143022.json
共记录 156 个状态快照
```

## 步骤3: 启动可视化服务器

```bash
python -m elevator_saga.visualization.web_server
```

会显示：
```
🚀 启动可视化服务器...
📍 访问地址: http://127.0.0.1:8080
📁 记录目录: E:\...\recordings
```

## 步骤4: 浏览器查看

1. 打开浏览器访问 http://127.0.0.1:8080
2. 页面会自动加载最新的记录文件
3. 点击"播放"按钮开始回放
4. 使用速度滑块调整播放速度（0.1x ~ 5x）
5. 拖动进度条可以跳转到任意时刻

## 界面操作

- **▶️ 播放**: 自动播放模拟过程
- **⏸️ 暂停**: 暂停在当前帧
- **⏮️ 重置**: 回到第一帧
- **速度滑块**: 调整播放速度
- **进度条**: 拖动跳转
- **记录选择**: 切换查看不同的历史记录

## 界面说明

### 主视图
- **左侧楼层标签**: F0, F1, F2... （底楼到顶楼）
- **中间电梯井道**: 显示每部电梯的实时位置
  - 🔵 蓝色: 上行
  - 🟠 橙色: 下行
  - 💠 浅色: 停止
  - 👤 图标: 电梯内乘客（数量）
  - 悬停查看乘客目的地
- **右侧等待队列**: 显示每层等待的乘客
  - ↑ 上行等待
  - ↓ 下行等待
  - P乘客ID→F目的地

### 统计面板（右侧上方）
- 总乘客数
- 已送达人数
- 运送中人数（电梯内）
- 等待中人数（楼层等待）
- 平均等待时间

### 事件日志（右侧下方）
- 实时显示关键事件
- 包括：按钮按下、电梯停靠、乘客上下车等

## 故障排除

### 问题: 没有记录文件
**解决**: 先运行 `visual_example.py` 生成记录

### 问题: WebSocket连接失败
**解决**:
1. 确认服务器已启动
2. 检查端口8080是否被占用
3. 查看浏览器控制台错误信息

### 问题: 页面空白
**解决**:
1. 确认static目录下有index.html, style.css, app.js
2. 检查浏览器控制台是否有JavaScript错误
3. 刷新页面重新加载

### 问题: 电梯显示不正常
**解决**:
1. 检查记录文件是否完整
2. 尝试加载其他记录文件
3. 重置播放器

## 进阶使用

### 修改播放速度范围
编辑 `static/index.html`，修改speed控件的min/max值

### 修改tick持续时间
编辑 `static/app.js`，修改 `baseTickDuration` 的值（毫秒）

### 自定义样式
编辑 `static/style.css`，可以修改颜色、大小、布局等

### 集成到自己的算法
继承 `VisualElevatorController` 或参考其实现，在你的控制器中调用 `_record_state()` 方法

## 更多帮助

查看完整文档: `README.md`
